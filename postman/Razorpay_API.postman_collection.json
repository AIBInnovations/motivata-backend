{
  "info": {
    "name": "Razorpay Payment API",
    "description": "Collection for testing Razorpay payment integration endpoints",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Create Order - Single Customer",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Save orderId for status check",
              "if (pm.response.code === 201) {",
              "    const response = pm.response.json();",
              "    pm.environment.set(\"orderId\", response.data.orderId);",
              "    pm.environment.set(\"paymentUrl\", response.data.paymentUrl);",
              "    console.log(\"Order ID:\", response.data.orderId);",
              "    console.log(\"Payment URL:\", response.data.paymentUrl);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{authToken}}",
            "description": "Optional - for authenticated users",
            "disabled": true
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"amount\": 1500,\n  \"currency\": \"INR\",\n  \"type\": \"EVENT\",\n  \"eventId\": \"{{eventId}}\",\n  \"metadata\": {\n    \"callbackUrl\": \"{{baseUrl}}/payment/callback\",\n    \"customerName\": \"John Doe\",\n    \"customerEmail\": \"john@example.com\",\n    \"customerPhone\": \"+919876543210\"\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/web/razorpay/create-order",
          "host": ["{{baseUrl}}"],
          "path": ["api", "web", "razorpay", "create-order"]
        },
        "description": "Create a payment order for a single customer purchase"
      },
      "response": []
    },
    {
      "name": "Create Order - Club/Combo (Multiple Customers)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Save orderId for status check",
              "if (pm.response.code === 201) {",
              "    const response = pm.response.json();",
              "    pm.environment.set(\"orderId\", response.data.orderId);",
              "    pm.environment.set(\"paymentUrl\", response.data.paymentUrl);",
              "    console.log(\"Order ID:\", response.data.orderId);",
              "    console.log(\"Payment URL:\", response.data.paymentUrl);",
              "    console.log(\"Number of customers:\", 3);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Authorization",
            "value": "Bearer {{authToken}}",
            "description": "Optional - for authenticated users",
            "disabled": true
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"amount\": 4500,\n  \"currency\": \"INR\",\n  \"type\": \"EVENT\",\n  \"eventId\": \"{{eventId}}\",\n  \"metadata\": {\n    \"callbackUrl\": \"{{baseUrl}}/payment/callback\",\n    \"customers\": [\n      {\n        \"name\": \"John Doe\",\n        \"email\": \"john@example.com\",\n        \"phone\": \"+919876543210\"\n      },\n      {\n        \"name\": \"Jane Smith\",\n        \"email\": \"jane@example.com\",\n        \"phone\": \"+919876543211\"\n      },\n      {\n        \"name\": \"Bob Johnson\",\n        \"email\": \"bob@example.com\",\n        \"phone\": \"+919876543212\"\n      }\n    ]\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/web/razorpay/create-order",
          "host": ["{{baseUrl}}"],
          "path": ["api", "web", "razorpay", "create-order"]
        },
        "description": "Create a payment order for club/combo purchase with multiple customers (SMS/email notifications disabled)"
      },
      "response": []
    },
    {
      "name": "Create Order - Session Payment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 201) {",
              "    const response = pm.response.json();",
              "    pm.environment.set(\"orderId\", response.data.orderId);",
              "    console.log(\"Session Order ID:\", response.data.orderId);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"amount\": 2000,\n  \"currency\": \"INR\",\n  \"type\": \"SESSION\",\n  \"sessionId\": \"{{sessionId}}\",\n  \"metadata\": {\n    \"callbackUrl\": \"{{baseUrl}}/payment/callback\",\n    \"customerName\": \"Alice Cooper\",\n    \"customerEmail\": \"alice@example.com\",\n    \"customerPhone\": \"+919876543213\"\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/web/razorpay/create-order",
          "host": ["{{baseUrl}}"],
          "path": ["api", "web", "razorpay", "create-order"]
        },
        "description": "Create a payment order for a session"
      },
      "response": []
    },
    {
      "name": "Get Payment Status",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    const response = pm.response.json();",
              "    console.log(\"Payment Status:\", response.data.status);",
              "    console.log(\"Amount:\", response.data.amount);",
              "    console.log(\"Payment ID:\", response.data.paymentId);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{authToken}}",
            "description": "Optional - for authenticated users",
            "disabled": true
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/api/web/razorpay/status/{{orderId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "web", "razorpay", "status", "{{orderId}}"]
        },
        "description": "Check payment status by order ID. Use this for long polling to track payment completion."
      },
      "response": []
    },
    {
      "name": "Webhook - Payment Captured",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-razorpay-signature",
            "value": "{{webhookSignature}}",
            "description": "Webhook signature from Razorpay"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"event\": \"payment.captured\",\n  \"payload\": {\n    \"payment\": {\n      \"entity\": {\n        \"id\": \"pay_MhYYYYYYYYYY\",\n        \"order_id\": \"{{orderId}}\",\n        \"amount\": 150000,\n        \"currency\": \"INR\",\n        \"status\": \"captured\",\n        \"method\": \"card\",\n        \"amount_refunded\": 0,\n        \"refund_status\": null,\n        \"captured\": true,\n        \"description\": \"Payment for EVENT\",\n        \"card_id\": \"card_XXXXXXXXXXXXXX\",\n        \"bank\": null,\n        \"wallet\": null,\n        \"vpa\": null,\n        \"email\": \"john@example.com\",\n        \"contact\": \"+919876543210\",\n        \"created_at\": 1732435800\n      }\n    }\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/web/razorpay/webhook",
          "host": ["{{baseUrl}}"],
          "path": ["api", "web", "razorpay", "webhook"]
        },
        "description": "Simulate Razorpay webhook for payment.captured event. Note: This requires valid webhook signature."
      },
      "response": []
    },
    {
      "name": "Webhook - Payment Failed",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-razorpay-signature",
            "value": "{{webhookSignature}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"event\": \"payment.failed\",\n  \"payload\": {\n    \"payment\": {\n      \"entity\": {\n        \"id\": \"pay_MhYYYYYYYYYY\",\n        \"order_id\": \"{{orderId}}\",\n        \"amount\": 150000,\n        \"currency\": \"INR\",\n        \"status\": \"failed\",\n        \"method\": \"card\",\n        \"error_code\": \"BAD_REQUEST_ERROR\",\n        \"error_description\": \"Payment failed due to insufficient funds\",\n        \"email\": \"john@example.com\",\n        \"contact\": \"+919876543210\",\n        \"created_at\": 1732435800\n      }\n    }\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/web/razorpay/webhook",
          "host": ["{{baseUrl}}"],
          "path": ["api", "web", "razorpay", "webhook"]
        },
        "description": "Simulate Razorpay webhook for payment.failed event"
      },
      "response": []
    },
    {
      "name": "Webhook - Order Paid",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-razorpay-signature",
            "value": "{{webhookSignature}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"event\": \"order.paid\",\n  \"payload\": {\n    \"order\": {\n      \"entity\": {\n        \"id\": \"{{orderId}}\",\n        \"amount\": 150000,\n        \"amount_paid\": 150000,\n        \"amount_due\": 0,\n        \"currency\": \"INR\",\n        \"receipt\": \"order_1732435800000_guest\",\n        \"status\": \"paid\",\n        \"attempts\": 1,\n        \"created_at\": 1732435800\n      }\n    }\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/web/razorpay/webhook",
          "host": ["{{baseUrl}}"],
          "path": ["api", "web", "razorpay", "webhook"]
        },
        "description": "Simulate Razorpay webhook for order.paid event"
      },
      "response": []
    },
    {
      "name": "Webhook - Payment Link Paid",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-razorpay-signature",
            "value": "{{webhookSignature}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"event\": \"payment_link.paid\",\n  \"payload\": {\n    \"payment_link\": {\n      \"entity\": {\n        \"id\": \"plink_MhXXXXXXXXXX\",\n        \"reference_id\": \"{{orderId}}\",\n        \"amount\": 150000,\n        \"currency\": \"INR\",\n        \"description\": \"Payment for EVENT (3 customers)\",\n        \"customer\": {\n          \"name\": \"John Doe\",\n          \"email\": \"john@example.com\",\n          \"contact\": \"+919876543210\"\n        },\n        \"status\": \"paid\",\n        \"created_at\": 1732435800\n      }\n    }\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/web/razorpay/webhook",
          "host": ["{{baseUrl}}"],
          "path": ["api", "web", "razorpay", "webhook"]
        },
        "description": "Simulate Razorpay webhook for payment_link.paid event"
      },
      "response": []
    },
    {
      "name": "Webhook - Payment Link Cancelled",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-razorpay-signature",
            "value": "{{webhookSignature}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"event\": \"payment_link.cancelled\",\n  \"payload\": {\n    \"payment_link\": {\n      \"entity\": {\n        \"id\": \"plink_MhXXXXXXXXXX\",\n        \"reference_id\": \"{{orderId}}\",\n        \"status\": \"cancelled\",\n        \"created_at\": 1732435800\n      }\n    }\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/web/razorpay/webhook",
          "host": ["{{baseUrl}}"],
          "path": ["api", "web", "razorpay", "webhook"]
        },
        "description": "Simulate Razorpay webhook for payment_link.cancelled event"
      },
      "response": []
    },
    {
      "name": "Webhook - Refund Processed",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "x-razorpay-signature",
            "value": "{{webhookSignature}}"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"event\": \"refund.processed\",\n  \"payload\": {\n    \"refund\": {\n      \"entity\": {\n        \"id\": \"rfnd_MhZZZZZZZZZZ\",\n        \"payment_id\": \"pay_MhYYYYYYYYYY\",\n        \"amount\": 150000,\n        \"currency\": \"INR\",\n        \"status\": \"processed\",\n        \"created_at\": 1732435800\n      }\n    }\n  }\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/web/razorpay/webhook",
          "host": ["{{baseUrl}}"],
          "path": ["api", "web", "razorpay", "webhook"]
        },
        "description": "Simulate Razorpay webhook for refund.processed event"
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "eventId",
      "value": "507f1f77bcf86cd799439011",
      "type": "string"
    },
    {
      "key": "sessionId",
      "value": "507f1f77bcf86cd799439012",
      "type": "string"
    },
    {
      "key": "orderId",
      "value": "",
      "type": "string"
    },
    {
      "key": "authToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "webhookSignature",
      "value": "test_signature_123",
      "type": "string"
    }
  ]
}
